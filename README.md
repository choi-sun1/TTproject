## 📖 목차

1. [✨ 프로젝트 소개](#-프로젝트-소개)
2. [🥳 팀소개](#-팀-소개)
3. [🔮 주요기능](#-주요기능)
4. [📚️ 기술스택](#️-기술스택)
5. [💭 기술적 의사 결정](#-기술적-의사-결정)
6. [🌐 Architecture](#-architecture)
7. [🗂 ERD](#-erd)
8. [🚨 Trouble Shooting](#-trouble-shooting)

## ✨ 프로젝트 소개
###  SmartTrip - 똑똑한 여행 AI
![](https://blog.kakaocdn.net/dn/MVDYp/btsL11Tv1zv/3TuYD9yiPKyrNTH94beA9K/img.gif)
> **여행 리뷰를 작성**하여 사용자끼리 여행 일정과 정보를 공유하고,
> **AI 와의 대화**를 통해서 **여행 일정을 더 간편하게 계획** 할 수 있게 돕는 서비스


## 🥳 팀 소개
- **팀명 : T.T (Traveler Tip)**

| 👑 리더 | 👑 부 리더 | ✨ 팀원 | ✨ 팀원 |
| --- | --- | --- | --- |
| 정용선 | 최해찬 | 차아인 | 이유림 |
|[@Dawol2205](https://github.com/Dawol2205)|[@choi-sun1](https://github.com/choi-sun1)|[@nyum76]()|[@createmycode](https://github.com/createmycode)|

#### 📌 [SA 문서 보기](https://teamsparta.notion.site/T-T-SA-v1-80b1b36366234f1d936d21b152bd4f86)


#### 🧑‍💻 개발기간
- `2024.12.30(목)` ~ `2025.01.31(금)`

## 🔮 주요기능
### 🧑‍💻 회원기능
<details>
<summary><b>회원가입</b></summary>
<div markdown="1">

![회원가입](https://blog.kakaocdn.net/dn/nEaAy/btsL2eZh13g/ququv8mrbukldzCMxBVdWk/img.gif)

</div>
</details>

<details>
<summary><b>로그인</b></summary>
<div markdown="1">

![로그인](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FMb7y2%2FbtsL3Pddhf1%2FnGSmciw2lJlYQSlLKhOHbk%2Fimg.png)

</div>
</details>

<details>
<summary><b>로그아웃</b></summary>
<div markdown="1">

오른쪽 위 프로필 한 번 누르고 로그아웃
![로그아웃](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fdb4piY%2FbtsL26fx1SM%2FSkXJ92Px1reViZAywvhmh0%2Fimg.png)

</div>
</details>


<details>
<summary><b>프로필 조회</b></summary>
<div markdown="1">

![프로필 조회](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fb68miH%2FbtsL4qYkujC%2Fu8xlVvZSM98OYix0l8wYeK%2Fimg.png)

</div>
</details>

<details>
<summary><b>회원 정보 수정 기능</b></summary>
<div markdown="1">

![회원 정보 수정](https://blog.kakaocdn.net/dn/m9Pjq/btsL3qxWM1m/I9N1W6tHk6JEPpkeOCkwE1/img.gif)

</div>
</details>


### 🤖 챗봇 기능
<details>
<summary><b>streaming 대화 기능</b></summary>
<div markdown="1">

![대화 기능](https://blog.kakaocdn.net/dn/cuxZ4M/btsL3mJeZOv/sriFSRYPLQEFK4g8GFm0L0/img.gif)

</div>
</details>

<details>
<summary><b>이전 대화보기</b></summary>
<div markdown="1">

![챗봇 기능](https://blog.kakaocdn.net/dn/baTCTx/btsL2A8TBpD/Axnw5Vf65UDC4uj1V52NH0/img.gif)

</div>
</details>

### 📆 여행 일정 기능
<details>
<summary><b>여행 일정 생성</b></summary>
<div markdown="1">

![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FTG5eD%2FbtsL4prACry%2FG5DLeejGE2rxwUB886mNWK%2Fimg.png)

</div>
</details>

<details>
<summary><b>여행 일정 보기</b></summary>
<div markdown="1">

</div>
</details>

### 🎨 그 외 기능

<details>
<summary><b>화면 다크/라이트 모드</b></summary>
<div markdown="1">

![화면 모드](https://blog.kakaocdn.net/dn/bZxYtm/btsL2aCXu6j/3ht0wz2FXx9OZH2Rzp3kg1/img.gif)

</div>
</details>



## 📚️ 기술스택

### Frontend & Tools

<div>
    <img src="https://img.shields.io/badge/Python-FFD43B?style=for-the-badge&logo=python&logoColor=blue">
    <img src="https://img.shields.io/badge/CSS3-1572B6?style=for-the-badge&logo=css3&logoColor=white">
    <img src="https://img.shields.io/badge/JavaScript-323330?style=for-the-badge&logo=javascript&logoColor=F7DF1E">
    <img src="https://img.shields.io/badge/Slack-4A154B?style=for-the-badge&logo=slack&logoColor=white">
    <img src="https://img.shields.io/badge/Jira-0052CC?style=for-the-badge&logo=Jira&logoColor=white">
    <img src="https://img.shields.io/badge/Notion-000000?style=for-the-badge&logo=notion&logoColor=white">
    <img src="https://img.shields.io/badge/Django-092E20?style=for-the-badge&logo=django&logoColor=green">
    <img src="https://img.shields.io/badge/GIT-E44C30?style=for-the-badge&logo=git&logoColor=white"/>
    <img src="https://img.shields.io/badge/GitHub-100000?style=for-the-badge&logo=github&logoColor=white">
    <img src="https://img.shields.io/badge/Figma-F24E1E?style=for-the-badge&logo=figma&logoColor=white">
    <img src="https://img.shields.io/badge/Colab-F9AB00?style=for-the-badge&logo=googlecolab&color=525252">
    <img src="https://img.shields.io/badge/Visual_Studio_Code-0078D4?style=for-the-badge&logo=visual%20studio%20code&logoColor=white">
    <img src="https://img.shields.io/badge/ZEP-6758ff?style=for-the-badge&logo=visual%20studio%20code&logoColor=white">
</div>


### ✔️ Backend & Tools

<div>
    <img src="https://img.shields.io/badge/Python-FFD43B?style=for-the-badge&logo=python&logoColor=blue">
    <img src="https://camo.githubusercontent.com/4c4a57a11a83f99eafb6eaaaaf65ea43e0fc446fccbf8533aac7e9be1067aaf7/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f446a616e676f2d3039324532303f7374796c653d666f722d7468652d6261646765266c6f676f3d446a616e676f266c6f676f436f6c6f723d7768697465">
    <img src="https://img.shields.io/badge/Postman-FF6C37?style=for-the-badge&logo=Postman&logoColor=white">
    <img src="https://img.shields.io/badge/scikit_learn-F7931E?style=for-the-badge&logo=scikit-learn&logoColor=white">
    <img src="https://img.shields.io/badge/ChatGPT-74aa9c?style=for-the-badge&logo=openai&logoColor=white">
    <img src="https://img.shields.io/badge/Slack-4A154B?style=for-the-badge&logo=slack&logoColor=white"/>
    <img src="https://img.shields.io/badge/Jira-0052CC?style=for-the-badge&logo=Jira&logoColor=white">
    <img src="https://img.shields.io/badge/Notion-000000?style=for-the-badge&logo=notion&logoColor=white">
    <img src="https://img.shields.io/badge/GitHub-100000?style=for-the-badge&logo=github&logoColor=white">
    <img src="https://img.shields.io/badge/GIT-E44C30?style=for-the-badge&logo=git&logoColor=white">
    <img src="https://img.shields.io/badge/Colab-F9AB00?style=for-the-badge&logo=googlecolab&color=525252"/>
    <img src="https://img.shields.io/badge/Visual_Studio_Code-0078D4?style=for-the-badge&logo=visual%20studio%20code&logoColor=white">
    <img src="https://img.shields.io/badge/ZEP-6758ff?style=for-the-badge&logo=visual%20studio%20code&logoColor=white">
    <img src="https://img.shields.io/badge/Sqlite-003B57?style=for-the-badge&logo=sqlite&logoColor=white">
    
</div>

### ✔️ Deploy

<div>
    <img src="https://img.shields.io/badge/AWS_EC2-FF9900?style=for-the-badge&logo=amazonaws&logoColor=white">
</div>

## 💭 기술적 의사 결정

<details>
<summary>React vs <b>HTML, CSS, JS</b></summary>
<div markdown="1">

- 프로젝트가 비교적 간단함.
- 동적인 인터페이스가 크게 필요하지 않음.
- Django 템플릿 엔진이 HTML, CSS, JS 와 완벽히 통합되어 있음.
- 초기 로드가 가볍고 빠름.

위와 같은 이유로 React 를 프론트엔드 프레임 워크로 사용하는 것 대신 HTML, CSS, JS 를 사용하기로 결정함.

</div>
</details>

<details>
<summary>NAVER Maps API, Kakao Maps API vs <b>Google Maps Places API</b></summary>
<div markdown="1">

SmartTrip에서 **사용자 경험 향상, 실시간 데이터 제공, 위치 기반 맞춤 추천**을 구현하는 데 Google Maps API가 더 적합한 것 같아서 선택함.

- Places API를 사용해 사용자 위치 기반으로 인기 장소 추천
- 숙박 조건(예: 가격, 편의 시설 등)에 따라 사용자 맞춤형 숙소 추천
- 특정 지역과 날짜에 열리는 축제 정보를 사용자에게 안내
- 공식문서에 레퍼런스가 가장 잘 정리되있고, 장소 별 리뷰가 가장 많음.

</div>
</details>

<details>
<summary>MySQL vs <b>SQLite3</b></summary>
<div markdown="1">

초반에는 MySQL 로 `settings.py` 도 설정하고 migrate 도 진행해 보았지만, MySQL 이 다중 사용자 환경에서 성능이 더 우수하고 대규모 프로젝트에 좋지만 그만큼 복잡하고  설정이 매우 번거로워서 아래와 같은 이유로 SQLite3 로 변경함.

- 원활한 데이터 공유
- SQL 서버 설정 따로 필요없음.
- 패키지 설치로 쉽게 설치
- 테스트용 데이터 입력 쉬움.

</div>
</details>


## 🌐 Architecture

![Architecture](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FRlUBs%2FbtsL4a2l7mo%2FK1VVuknLl0w4KiTaEhhBkK%2Fimg.png)



## 🗂 ERD

![ERD](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2F5a2lG%2FbtsL3hOM2xG%2F2txVf3SkK8hQSJwuk5bGW0%2Fimg.png)




## 🚨 Trouble Shooting

### 🌝 FE

<details>
<summary><b>로그인 후 프로필 사진 사이즈 조절문제</b></summary>
<div markdown="1">



#### 원인

초기에 업로드한 프로필 이미지 사이즈 지정을 하지않음
___

#### 해결
[ 1️⃣ ] 크롬 브라우저 개발자 도구로 해당 위치의 CSS코드 파일 확인 후 해당 코드를 찾고 사이즈 조절 완료

</div>
</details>

<details>
<summary><b>챗봇 - 화면상에 줄바꿈 적용이 안 되는 문제</b></summary>
<div markdown="1">


#### 원인

챗봇 응답 생성시 streaming 기능을 적용시키다가 생성하는 토큰마다 단을 바꾼다는 문제를 해결하려고

메시지가 여러 줄로 입력되어도 HTML에서 한 줄로 출력되도록 해버렸던 것이 문제였음.
___

#### 해결
**❗️ chat.html 을 아래와 같이 수정함**

[ 1️⃣ ] CSS수정 - `.chat-message.user`, `.chat-message.bot` 클래스에 `white-space: pre-wrap;` 속성을 추가하여, HTML 내에서 줄 바꿈이 유지되도록 설정

[ 2️⃣ ] Django 템플릿 필터인 `{{ conversation.user_message|linebreaksbr }}`와 `{{ conversation.bot_reply|linebreaksbr }}`를 사용해 텍스트 내의 줄 바꿈 `(\n)`을 HTML의 `<br>` 태그로 변환

[ 3️⃣ ] `userMessage.replace(/\n/g, "<br>")`로 사용자의 입력에서 줄 바꿈을 `<br>` 로 변환

</div>
</details>

### 🌚 BE

<details>
<summary><b>MySQL에 접속시 Access Denied 오류 발생</b></summary>
<div markdown="1">



#### 원인

다운 폴더에 기존에 다운받은 것과 충돌이 일어나 MySQL 접속이 불가능
___

#### 해결

[ 1️⃣ ] 아래의 명령어를 차례로 입력해 모두 삭제
- `sudo brew services stop mysql`

- `brew uninstall mysql`

- `rm -rf /opt/homebrew/var/mysql`

- `brew install mysql`


[ 2️⃣ ] 재설치

`brew install mysql`
</div>
</details>

<details>
<summary><b>migrate 하면 발생했던 1824 에러</b></summary>
<div markdown="1">

#### 원인
내 브랜치에서 테스트 했던 DB 와 팀원 브랜치의 DB 내용이 달라서
- `python manage.py makemigrations`
- `python manage.py migrate`

위 명령어 입력하면 발생함

---

#### 해결
각 앱 별로 따로따로 마이그레이션 진행
```zsh
# accounts 앱에 대한 migrate
python manage.py makemigrations accounts

python manage.py migrate accounts

# 위와 같은 방식으로 다른 앱 모두 migrate
```

</div>
</details>


<details>
<summary><b>챗봇 - 대화 상태 관리 오류</b></summary>
<div markdown="1">



#### 원인

ChatState 모델의 `current_step` 상태가 초기화되지 않거나 누락되어 대화 흐름이 끊어짐.
___

#### 해결
[ 1️⃣ ] ChatState.objects.get_or_create() 메서드를 사용하여 사용자별 초기 상태를 항상 생성하도록 설정

[ 2️⃣ ] 대화 단계 전환 로직을 명확히 분리하고, 상태 저장 시 예상치 못한 데이터 손실을 방지하기 위해 모델 필드 검증 추가
</div>
</details>

<details>
<summary><b>챗봇 - 이전 대화 내역 형식이 답변 생성시와 다른 문제</b></summary>
<div markdown="1">


#### 원인

chatbot 앱의 `views.py` 에서

챗봇이 markdown 으로 출력하지 말라는 prompt 의 내용을 무시해서 이 부분을 해결하기 위해 만든 `remove_markdown()` 이라는 함수가

출력시에는 적용되지 않는데, DB 에 저장될 때에만 `clean_reply` 변수를 통해 저장이 되는 것이었음.
___

#### 해결
[ 1️⃣ ] 마크다운 문법 출력 문제는 프롬프팅으로 잘 해결 되었으므로, `remove_markdown` 함수와 이와 관련된 부분 주석 처리

```py
from django.shortcuts import render, redirect
from django.contrib.auth.decorators import login_required
from django.conf import settings
from openai import OpenAI
from .models import Conversation
from .forms import ChatForm
from django.http import StreamingHttpResponse
import time
import re

CLIENT = OpenAI(api_key=settings.OPENAI_API_KEY)

# def remove_markdown(text):
#     text = re.sub(r'\*\*(.*?)\*\*', r'\1', text)
#     text = re.sub(r'\*(.*?)\*', r'\1', text)
#     text = re.sub(r'`(.*?)`', r'\1', text)
#     text = re.sub(r'#+\s', '', text)
#     text = re.sub(r'(\n- |\n\*)', '\n', text)
#     text = text.replace('•', '')
#     text = re.sub(r'(\d+\.\s)', '', text)
#     text = re.sub(r'\n\s*\n', '\n', text)
#     return text.strip()

@login_required
def chat_view(request):
    if request.method == 'GET':
        show_history = request.GET.get('show_history', 'false') == 'true'
        conversations = Conversation.objects.filter(user=request.user).order_by('timestamp') if show_history else []
        return render(request, 'chatbot/chat.html', {'conversations': conversations, 'form': ChatForm(), 'show_history': show_history})

    prompt = '''
    응답을 반드시 **일반 텍스트 형식**으로 작성해야 합니다.

    1. 문장을 **줄글로 이어쓰지 말고, 문단 단위로 구분하세요.**  
    2. 각 문단 사이에 **한 줄(`\n`)의 빈 줄을 추가하세요.**
    3. 문장은 완전한 형태로 작성하고, 문단을 **짧고 간결하게 유지하세요.**
    4. 텍스트만 사용하고, 마크다운을 **절대 포함하지 마세요.**

    예제:
    ---
    사용자: 서울 2박 3일 여행 일정을 추천해줘.
    AI:
    강릉에서의 1박 2일 여행은 정말 멋진 선택이에요!

첫째 날 일정을 추천해볼게요:

오전: 도착 및 카페 탐방
- 아침에 강릉에 도착한 후, 유명한 커피 명소인 ‘강릉커피거리’를 방문해보세요.
- 다양한 카페에서 커피를 즐기며 바다가 보이는 멋진 경치를 감상할 수 있습니다.

점심: 지역 맛집
- ‘초당순두부’나 ‘강릉회센터’ 같은 지역 맛집에서 점심을 먹어보세요.
- 신선한 해산물이나 순두부 요리를 추천합니다.

오후: 경포대 및 해변 산책
- 점심 후 경포대로 이동해보세요.
- 경포대에서 바다를 바라보며 산책하고, 주변 사진도 찍어보세요.
- 경포해변에서 바다에 발을 담그며 여유로운 시간을 가져도 좋습니다.

저녁: 바베큐 혹은 해산물 요리
- 숙소에서 바베큐를 즐길 수도 있고, ‘속초 수산시장’에 가서 신선한 해산물을 즐기는 것도 좋습니다.

밤: 해변 산책 또는 휴식
- 저녁 식사 후에는 해변을 따라 산책하며 일몰을 감상해보세요.
- 숙소에서 자유롭게 휴식을 취하는 것도 좋은 선택이에요.

둘째 날 일정을 제안해드릴게요:

오전: 안목해변 카페 탐방
- 아침 식사 후 안목해변으로 이동해 근처의 카페에서 아침 커피와 간단한 아침을 즐기세요.
- 해안선 따라 걷는 것도 좋은 아침 산책이 됩니다.

오후: 명소 방문 및 돌아가기
- ‘선교장’이나 ‘오죽헌’을 방문해 전통적인 한국의 모습을 느껴보세요.
- 강릉의 역사와 문화를 체험할 수 있는 좋은 기회가 될 것입니다.

이후 여행을 마치고 돌아가는 일정으로 계획하면 좋겠네요. 필요에 따라 일정 수정도 가능하니 언제든지 말씀해 주세요!
    ---

    위 예제와 같은 방식으로 답변하세요.
    '''

    if request.method == 'POST':
        user = request.user
        form = ChatForm(request.POST)
        if form.is_valid():
            user_message = form.cleaned_data["user_message"]

            def generate_response():
                stream = CLIENT.chat.completions.create(
                    model="gpt-4o",
                    stream=True,
                    messages=[
                        {"role": "system", "content": prompt},
                        {"role": "user", "content": user_message}
                    ]
                )

                bot_reply = ""

                for chunk in stream:
                    if hasattr(chunk, "choices") and chunk.choices:
                        delta = chunk.choices[0].delta
                        if hasattr(delta, "content") and delta.content:
                            text = delta.content
                            bot_reply += text
                            yield text.replace('\n', '<br>')
                            time.sleep(0.05)

        #        clean_reply = remove_markdown(bot_reply)

                Conversation.objects.create(
                    user=user,
                    user_message=user_message,
                    bot_reply=bot_reply # 현재 대화 내용과 DB 에 저장되는 이전 대화 내용을 같게 하기 위해 clean_reply 사용 X
                )

            return StreamingHttpResponse(generate_response(), content_type='text/html')

    return render(request, 'chatbot/chat.html', {'form': ChatForm()})


@login_required
def new_chat(request):
    request.session['new_chat'] = True
    return redirect('chatbot:chat')  # chat_view로 리디렉션
```


</div>
</details>

<details>
<summary><b>JWT 인증 실패 문제</b></summary>
<div markdown="1">



#### 원인

API 요청 시 Authorization 헤더에 토큰이 누락되거나 올바르지 않은 포맷으로 전달
___

#### 해결
[ 1️⃣ ] 클라이언트에서 요청 시 헤더에 `Authorization: Bearer <JWT 토큰>`을 올바르게 포함하도록 수정

[ 2️⃣ ] Django REST Framework 에서 `IsAuthenticated` 권한 클래스를 추가하고, 인증 실패 시 적절한 에러 메시지를 반환하도록 예외 처리 구현

</div>
</details>
